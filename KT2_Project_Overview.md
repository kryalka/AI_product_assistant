# CookiQ: Mid-Update (КТ-2)

## Совкова София (интеграция и объединение компонентов)
Выполнена интеграция Telegram-бота, нейросети и парсера данных для обеспечения их согласованного взаимодействия. Реализованы функции обработки пользовательских запросов, уточнения результатов и сопоставления товаров с позициями каталога. Добавлены механизмы автообновления базы данных и уточнённые сценарии работы для улучшения пользовательского интерфейса.

### Сделано:
#### 1. Интеграция функциональности Telegram-бота с нейросетью:
- работана функция handle_text, которая обеспечивает обработку текстовых запросов от пользователей.
- Эта функция взаимодействует с нейросетью для генерации списка необходимых продуктов, исходя из сценария, предложенного пользователем (например, “хочу борщ на неделю”).
- Реализует управление сценариями, позволяя корректно интерпретировать запросы пользователей и выдавать релевантные результаты.
#### 2.	Объединение модулей парсера и нейросети:
- Обеспечено автоматическое сопоставление списка продуктов, сформированного нейросетью, с товарами, доступными в базе данных магазина (ВкусВилл). Это позволяет пользователям получать список покупок с актуальными ссылками на товары и ценами.
- Настроено ежедневное обновление базы данных в ассинхронном процессе, для корректной работы бота во время обновления.
#### 3. Изменение нейросетевого запроса:
- В запрос к нейросети добавлена возможность указывать единицы измерения продуктов. Это улучшило точность генерации ответов и сделало результаты более понятными для пользователя.
#### 4.	Реализация функции get_links_from_list:
-	Функция связывает продукты, указанные пользователем, с товарами из базы данных.
- Оптимизирован алгоритм выбора наиболее выгодного товара (минимизация цены за грамм).
-	Реализована фильтрация и обработка несоответствий в единицах измерения товаров.
-	Учитывается структура базы данных магазина и нюансы сопоставления.
#### 5.	Общий рефакторинг и интеграция:
-	Обеспечена согласованность работы всех компонентов: Telegram-бота, парсера и нейросети. Код структурирован для дальнейшего масштабирования и дополнения.


## Синицина Софья (Телеграм-бот):

• Сделано: разработала Telegram-бота с функциональностью для создания и управления списками покупок, а также для работы с избранными корзинами и историей заказов.

### Реализованные функции:
1. Основное меню:
   - `start()`: Запускает бота и показывает меню с возможностью выбрать одну из опций (составить корзину, просмотреть избранное, просмотреть историю покупок).
   - `send_main_menu()`: Отправляет главное меню с кнопками для выбора действия.

2. Создание корзины:
   - `shopping()`: Позволяет пользователю описать, что он хочет приготовить или ввести список продуктов.
   - `handle_text()`: Обрабатывает текстовые сообщения от пользователя для создания корзины, извлекая ингредиенты с помощью функции `get_ingredients_list` и предлагает сохранить корзину в избранное.

3. Избранное:
   - `button()`: Обрабатывает нажатия кнопок и управляет переходами между состояниями.
   - `send_favorites_menu()`: Отправляет меню с избранными корзинами.

4. Логирование действий:
   - `log()`: Логирует действия пользователя, как текстовые сообщения, так и нажатия на кнопки.

5. Обработка ошибок и валидация данных:
   - Обработка ошибок при пустых или некорректных запросах от пользователя.
   - Улучшение валидации введённых данных (например, проверка корректности списка продуктов).

### Осталось сделать:
1. Добавить кнопку /help (!!)
2. Продумать логику функции истории покупок и как сделать красивый интерфейс этой функции (?)
3. Разработать функцию создания рецепта
4. Поделить избранное на: избранные покупки и избранные рецепты
5. Реализован возможности редактирования корзины и избранных корзин (переименовать корзину, редактировать продукты в ней)
6. Реализовать красивый интерфейс трекера покупок (т.е. по мере покупки товаров пользователь мог отмечать уже купленные товары)

## Маргарита Иванова (парсер):
Выполненная работа позволила автоматизировать сбор данных о продуктах с сайта “ВкусВилл” и интегрировать их в общую базу. Этот компонент обеспечил проект надежными данными, которые могут быть использованы в Telegram-боте и других модулях.

### Сделано:

#### 1. Изучение и использование API Ozon:
-    Зарегистрировалась как самозанятый продавец на платформе Ozon Seller для получения доступа к API.
-    Успешно подключилась к API Ozon и извлекла структуру категорий товаров.
-	  Обнаружила ограничение: API предоставляет доступ только к данным товаров собственного магазина, из-за чего невозможно получить товары из раздела Ozon Fresh.
#### 2. Анализ и выбор новой стратегии:
-    В связи с ограничениями API было принято решение парсить данные напрямую с веб-страниц.
-    Выбрала интернет-магазин “ВкусВилл” благодаря большому ассортименту товаров и простой структуре сайта.
#### 3. Разработка парсера для сайта “ВкусВилл”:
-	Настроила заголовок User-Agent для имитации реального браузера, предотвращая блокировку запросов.
-	Реализовала функцию get_categories для извлечения всех категорий товаров с сайта.
-	Создала функцию get_total_pages для определения числа страниц в каждой категории.
-	Разработала метод parse_products, позволяющий собрать данные о товарах, включая название, ссылку, вес и цену.
-	Обработала данные для записи в формате JSON.
#### 4. Интеграция и оптимизация:
-	Настроила структуру для сохранения всех продуктов, организованных по категориям.
-	Обеспечила обработку ошибок при сборе данных для минимизации сбоев в работе.
-	Парсер позволяет получать актуальную информацию о продуктах для использования в других компонентах проекта.
#### 5. Тестирование:
-  Написаны тесты для проверки корректности всех функций. Смоделированы возможные ответы сайта и обработаны все случаи.



## Матвей Хорт (Запросы к OpenAI для генерации рецептов):
 Отвечал за разработку механизмов взаимодействия с OpenAI API для получения рецептов и расчета ингредиентов. Моя задача заключалась в создании функций, которые обрабатывают запросы пользователя и возвращают точные данные о рецептах и ингредиентах.

### Сделано: 

#### 1. Запросы к OpenAI через прокси:
-  Реализована функция ask_gpt_with_proxy, которая отправляет запросы к OpenAI через прокси-сервер. Это позволяет обходить блокировки.
#### 2. Определение количества порций:
- Функция get_number_of_portions анализирует запрос пользователя и с помощью OpenAI определяет количество порций, выводя его как целое число.
#### 3. Генерация ингредиентов для одной порции:
- Функция get_ingredients_per_portion извлекает список ингредиентов с точными количествами для одной порции в JSON-формате, используя OpenAI.
#### 4. Перерасчет ингредиентов на нужное количество порций:
- Функция get_ingredients_list умножает количество ингредиентов для одной порции на количество порций, полученное из предыдущей функции, генерируя итоговый список ингредиентов.
#### 5. Генерация инструкций по приготовлению:
- Функция get_preparation_instructions создает пошаговую инструкцию по приготовлению на основе полученных ингредиентов и названия блюда.
#### 6. Обработка ошибок и валидация данных:
- Внедрена обработка ошибок для проверки структуры данных и повторных попыток запросов в случае некорректных ответов от OpenAI.
#### 7. Тестирование:
- Написаны тесты для проверки корректности всех функций, включая обработку запросов, генерацию ингредиентов и инструкций.
